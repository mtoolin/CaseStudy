---
title: "Case Study of countries GDP"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
library(knitr)
```

## Presented by Michael Toolin, Venkat Karsala and Jamie Villenueva
#Introduction
A series of questions were presented regarding GDP data.  The data was provided in two different data sets.
The data sets needed to be read from the internet, cleaned, merged and then the questions are answered.

```{r missmatch, echo=TRUE}
dfgdp_2012_final <- read.csv('../data/dfgdp_2012_final.csv', stringsAsFactors = FALSE)
edstats_final <- read.csv('../data/edstats_final.csv', stringsAsFactors = FALSE)
NumMatches <- inner_join(dfgdp_2012_final,edstats_final)%>% summarise(cnt=n())%>% as.numeric()
``` 
#### Question 1
The first question presented was how many ID's in the two data sets matched.  
```{r}
cat("There were",NumMatches,"found to be the same in the data sets \n")
```
#### Question 2
The second question is find out the 13th Country when ordered by GDP in ascending order
```{r arranged, echo=TRUE}
cleaned_merged1 <- read.csv('../data/cleaned_merged_final.csv')
arrangByUSD <- arrange(cleaned_merged1, Millions.US.Dollars)
cat("The 13th country in the ascending GDP rankings is",arrangByUSD$Country[13]%>%as.character(),"\n")
```
#### Question 3
The third question presented was to find the average GDP rankings for the **High Income:OECD** group and the **High Income:nonOECD** group.
```{r MeanRaning, echo=TRUE}
cleaned_merged1 %>% filter(Income.Group %in% c("High income: OECD" , "High income: nonOECD")) %>% group_by(Income.Group) %>% summarise( average = mean(Ranking)) %>% mutate_if(is.factor, as.character) %>% as.data.frame(as.matrix(),stringsAsFactors=F)
```
The difference in mean of High Income:nonOECD vs. High Income:OECD is \$59 million. High Income:nonOECD increases by \$1.79 million for every million High Income:OECD increases.

#### Question 4
Below is a scatter plot and bar graph for **GDP of all countries** 
by Income Group:
```{r GDPPlot, echo=TRUE}
#
# Build a scatter chart of GDP vs Income Group
#
colgrp <- cleaned_merged1$Income.Group
ggplot(cleaned_merged1, aes(x=CountryCode, y=log(Millions.US.Dollars), group=colgrp,shape=colgrp)) + geom_point(aes(colour=colgrp)) + scale_shape_manual(values=c(19,20,21,22,23))+scale_colour_manual(values=c("blue", "red","gray","black","purple"))
#
# Build Bar chart of GDP by Income Group
#
g<-ggplot(data=(subset(cleaned_merged1, !is.na(Income.Group))), aes(Income.Group))
g + geom_bar(aes(weight=Millions.US.Dollars, fill=Income.Group)) +theme(axis.text.x = element_text(angle=60, hjust=1))
```
<br>

#### Question 5
The table below displays the GDP rankings seperated into 5 different groups.
```{r question5,echo=TRUE}
#
# Read the data from the file and seperate into quantiles
#
Cleaned.Merged.Analysis <- read.csv('../data/cleaned_merged_final.csv', stringsAsFactors = FALSE)
quantile(Cleaned.Merged.Analysis$Ranking, seq(0, 1, length=6))
```
Here we can see that 20% of the countries are ranked below 39.  This means the top 20% of the countries by GDP are ranked from 1 to 38.  The bottom 20% are ranked below 152.  This means 60%, over half, of the ranked countries have a rank from 39 to 151.

<br>

There are five countres in the Lower Middle Income group but rank higher than 39 on the GDP list
```{r}
Income.Group_table <- Cleaned.Merged.Analysis
Income.Group_table <- Income.Group_table[c("Income.Group", "CountryCode", "Country", "Ranking", "Millions.US.Dollars")]


for (x in 1:length(Income.Group_table$Income.Group)){
ifelse(is.na(Income.Group_table$Income.Group[x]),Income.Group_table<-Income.Group_table[-x,],"NA")
ifelse(Income.Group_table$Income.Group[x]=="Lower middle income", Income.Group_table$newcolumn[x]<-4,"NA")
ifelse(Income.Group_table$Income.Group[x]=="Upper middle income", Income.Group_table$newcolumn[x]<-3,"NA")
ifelse(Income.Group_table$Income.Group[x]=="Low income", Income.Group_table$newcolumn[x]<-5,"NA")
ifelse(Income.Group_table$Income.Group[x]=="High income: OECD", Income.Group_table$newcolumn[x]<-1,"NA")
ifelse(Income.Group_table$Income.Group[x]=="High income: nonOECD", Income.Group_table$newcolumn[x]<-2,"NA")
}

sorted.Income.Group_table <- arrange(Income.Group_table, newcolumn, desc(Millions.US.Dollars))
sorted.Income.Group_table <- sorted.Income.Group_table[-6]
filter(sorted.Income.Group_table,sorted.Income.Group_table$Income.Group == "Lower middle income", Ranking < 39)
```

```{r, results='asis'}
writeLines("td, th { padding : 6px } th { background-color : brown ; color : white; border : 1px solid white; } td { color : brown ; border : 1px solid brown }", con = "mystyle.css")
dset1 <- head(sorted.Income.Group_table,20)
knitr::kable(dset1, format = "html")
```




